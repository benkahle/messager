var underscore = require('underscore');
var net = require('net');
var EventEmitter = require('events').EventEmitter;

var chat = {
  createServer: function(config) {
    var emitter = new EventEmitter();    
    var onSocketConnection = function (socket) {
      emitter.emit('client connected', socket);
    }
    return {
      on: function(event, callback) {
        emitter.on(event, callback);
      },
      start: function() {
        if (config.httpServer != null) {
          var io = require('socket.io').listen(config.httpServer);
          io.sockets.on('connection', onSocketConnection);
        }
        if (config.tcpHost != null && config.tcpPort != null) {
          var server = net.Server();
          server.on('connection', onSocketConnection);
          server.listen(config.tcpPort, config.tcpHost);
        }
      }
    }
  }
};

module.exports = chat;